/* optimal_paging.c */
#include <stdio.h>
#include <stdlib.h>
#include <limits.h>

int find_optimal_victim(int *frame, int frames, int *ref, int n, int idx) {
    int victim = -1, farthest = idx;
    for(int i=0;i<frames;i++){
        int j;
        for(j=idx;j<n;j++){
            if(frame[i] == ref[j]) {
                if(j > farthest){ farthest = j; victim = i; }
                break;
            }
        }
        if(j == n) return i; // not found again -> best victim
    }
    if(victim==-1) return 0;
    return victim;
}

int main(){
    int frames, n;
    printf("Number of frames: "); scanf("%d",&frames);
    printf("Length of reference string: "); scanf("%d",&n);
    int ref[n];
    for(int i=0;i<n;i++) scanf("%d",&ref[i]);

    int *frame = malloc(frames*sizeof(int));
    for(int i=0;i<frames;i++) frame[i]=-1;
    int faults=0;

    for(int i=0;i<n;i++){
        int page = ref[i];
        int found=0;
        for(int j=0;j<frames;j++) if(frame[j]==page) { found=1; break; }
        if(!found){
            int placed = 0;
            for(int j=0;j<frames;j++) if(frame[j]==-1){ frame[j]=page; placed=1; break; }
            if(!placed){
                int victim = find_optimal_victim(frame, frames, ref, n, i+1);
                frame[victim] = page;
            }
            faults++;
        }
        printf("After ref %d: ", page);
        for(int j=0;j<frames;j++) printf("%d ", frame[j]);
        printf("\n");
    }
    printf("Total faults: %d\n", faults);
    free(frame);
    return 0;
}
